<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SSH tunnels explained &mdash; Data mitigations</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Using Tor" href="Tor.html" />
    <link rel="prev" title="Renew IP lease" href="Renew-IP-lease.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Data mitigations
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Goals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Avoiding-surveillance.html">Avoiding surveillance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Circumventing-censorship.html">Circumventing censorship</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Infosec-goals.html">Infosec goals</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Safer browsing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../browsing/README.html">Browser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../browsing/Browser-configuration-editors.html">Browser configuration editors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../browsing/Browser-plugins.html">Browser plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../browsing/Cookies.html">Cookie monsters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../browsing/FLoC.html">Federated Learning of Cohorts (FLoC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../browsing/Private-browsing.html">Private browsing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../browsing/User-agent-switchers.html">User-agent switchers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../browsing/alternatives.html">Alternative browsers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Anonymising traffic</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Anonymising traffic</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chaining.html">Chaining</a></li>
<li class="toctree-l1"><a class="reference internal" href="Change-MAC-address.html">Change MAC address</a></li>
<li class="toctree-l1"><a class="reference internal" href="Change-nickname.html">Change nickname</a></li>
<li class="toctree-l1"><a class="reference internal" href="Creating-secure-VPN-with-SSH-and-tun.html">Creating a secure VPN with SSH and tun</a></li>
<li class="toctree-l1"><a class="reference internal" href="DNS-leaks.html">DNS leaks</a></li>
<li class="toctree-l1"><a class="reference internal" href="Digital-mixing.html">Digital mixing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Edit-hosts-file.html">Edit hosts file</a></li>
<li class="toctree-l1"><a class="reference internal" href="I2P.html">I2P</a></li>
<li class="toctree-l1"><a class="reference internal" href="Renew-IP-lease.html">Renew IP lease</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">SSH tunnels explained</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tor.html">Using Tor</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tunnelling.html">Tunnelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="VPN.html">Choosing a VPN</a></li>
<li class="toctree-l1"><a class="reference internal" href="VPN-fail-open.html">Fail open</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Email</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../email/README.html">Email</a></li>
<li class="toctree-l1"><a class="reference internal" href="../email/Anonymising-email.html">Anonymising email</a></li>
<li class="toctree-l1"><a class="reference internal" href="../email/HIBP.html">‘;–have i been pwned?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../email/Using-GnuPG.html">Using GnuPG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../email/Viewing-email-headers.html">Viewing email headers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">E2EE messaging</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../e2ee/README.html">E2EE messaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../e2ee/Choosing-E2EE-messaging.html">Choosing E2EE messaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../e2ee/Installing-and-using-Signal.html">Installing and using Signal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../e2ee/Installing-and-using-Wire.html">Installing and using Wire</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">File transfer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filetransfer/README.html">File transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filetransfer/Checking-integrity-of-downloads.html">Checking integrity of downloads (Linux)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filetransfer/Choosing-file-sharing-services.html">Choosing file sharing services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filetransfer/Uploading-files-to-a-server.html">Uploading files to a server</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data in rest</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../data/README.html">Protecting data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/Archiving-and-compressing.html">Archiving and compressing (Linux)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/File-encryption.html">File encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/Managing-passwords.html">Managing passwords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/Shredding-files-and-deleting-data.html">Shredding files and deleting data (Linux)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/Using-cryptsetup.html">Using cryptsetup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/Using-removable-storage-media.html">Using removable storage media</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/Using-rsync.html">Using rsync (Linux)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/Using-unison.html">Using unison (OSX, Unix, and Windows)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Metadata</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../metadata/README.html">Removing metadata from files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metadata/BleachBit.html">Bleachbit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metadata/Edit-exif-metadata-in-images.html">Edit exif metadata in images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metadata/MAT.html">Metadata Anonymisation Toolkit (MAT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../metadata/Removing-metadata-with-hexeditors.html">Removing metadata with hex editors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Web applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../webapplication/README.html">Web-applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../webapplication/Cookied-wps.html">Cookied Wordpresses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../webapplication/FloCed-sites.html">FloCed sites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../webapplication/Secure-file-transfer.html">Secure file transfer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">All mitigations</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://tymyrddin.github.io/mitigations/">Overview</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Data mitigations</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>SSH tunnels explained</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/docs/traffic/SSH.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ssh-tunnels-explained">
<h1>SSH tunnels explained<a class="headerlink" href="#ssh-tunnels-explained" title="Permalink to this heading"></a></h1>
<p>Secure Shell (SSH) can be used to securely acquire and use a remote terminal session and has other uses as well. You can use SSH to tunnel traffic, transfer files, mount remote file systems, and more. SSH also uses strong encryption and you can set your SSH client to act as a Socks proxy. Once you have, you can configure applications on your computer – such as your web browser – to use the Socks proxy. The traffic enters the Socks proxy running on your local system and the SSH client forwards it through the SSH connection – this is known as SSH tunneling. This works similar to browsing the web over a <a class="reference internal" href="VPN.html"><span class="doc std std-doc">Virtual Private Network (VPN)</span></a>. From a web server perspective, traffic appears to be coming from the SSH server. The traffic between source and the SSH server is encrypted, so you can browse over an encrypted connection as you could with a VPN. You must configure each application to use the SSH tunnel’s proxy.</p>
<p>Port forwarding or port mapping is a name given to the combined technique of:</p>
<ul class="simple">
<li><p>Translating the address and/or port number of a packet to a new destination.</p></li>
<li><p>Possibly accepting such packet(s) in a packet filter (firewall).</p></li>
<li><p>Forwarding the packet according to the routing table.</p></li>
</ul>
<p>SSH tunnels can be created in several ways using different kinds of port forwarding mechanisms.</p>
<section id="tunnelling-with-local-port-forwarding">
<h2>Tunnelling with local port forwarding<a class="headerlink" href="#tunnelling-with-local-port-forwarding" title="Permalink to this heading"></a></h2>
<p>Imagine wikileaks being blocked using a proxy filter in a university network somewhere. A SSH tunnel can be used to bypass this restriction.</p>
<p>Let’s name the machine in the university network //socially-correct// and a home machine //home//. The home machine has a public IP and is running a SSH server. The student in case has //ssh user access// on //home// and //socially-correct// has access to <code class="docutils literal notranslate"><span class="pre">host:hostport</span></code> (is not blocked).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh -L localport:host:hostport user@home -N 
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-L</span></code>: port forwarding parameters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">localport</span></code>: local port (choose a port that is not in use by other service)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">host</span></code>: server that has the port (hostport) that you want to forward</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hostport</span></code>: remote port</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-N</span></code>: do not execute a remote command (you will not have the shell).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user</span></code>: user that has <code class="docutils literal notranslate"><span class="pre">ssh</span></code> access to the ssh server</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">home</span></code>: the machine/server running the <code class="docutils literal notranslate"><span class="pre">ssh</span></code> server that will be used for forwarding/tunneling</p></li>
</ul>
<p>For example, to create the SSH tunnel execute following from the //socially-correct machine//:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh -L 9001:wikileaks.org:80 user@home
</pre></div>
</div>
<p><img alt="Port forwarding" src="../../_images/port-forwarding.png" /></p>
<p>Open a browser and go to http://localhost:9001 to see if the tunnel is working.</p>
<p>The SSH client at socially-correct will connect to the SSH server running at home (usually running at port 22) binding port 9001 of socially-correct to listen for local requests thus creating a SSH tunnel between home and socially-correct. At the home end it will create a connection to wikileaks.org at port 80. So socially-correct doesn’t need to know how to connect to wikileaks.org. Only home needs to worry about that. The channel between socially-correct and home will be encrypted while the connection between home and wikileaks.org will be unencrypted.</p>
<p>The home-to-wikileaks.org connection is only made when the browser makes the request, not at tunnel setup time.</p>
<p>The SSH man pages say:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-L</span> <span class="pre">port:host:hostport</span></code> specifies that the given port on the local (client) host is to be forwarded to the given host and port on the remote side. This works by allocating a socket to listen to port on the local side, and whenever a connection is made to this port, the connection is forwarded over the secure channel, and a connection is made to host port hostport from the remote machine. Port forwardings can also be specified in the configuration file. Only root can forward privileged ports. IPv6 addresses can be specified with an alternative syntax: <code class="docutils literal notranslate"><span class="pre">port/host/hostport</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-N</span> </code>Do not execute a remote command. This is useful for just forwarding ports (protocol version 2 only).</p></li>
</ul>
<p>Local port forwarding can also be used to set up a VNC session between socially-correct and a home server. From socially-correct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh -L 5900:localhost:5900 user@home
</pre></div>
</div>
<p>The localhost is relative to the gateway (home in this case), not the machine from where the tunnel is initiated. So this will make a connection to port 5900 of the home computer where the VNC client would be listening.</p>
</section>
<section id="reverse-tunnelling-with-remote-port-forwarding">
<h2>Reverse tunnelling with remote port forwarding<a class="headerlink" href="#reverse-tunnelling-with-remote-port-forwarding" title="Permalink to this heading"></a></h2>
<p>To be able to SSH from the Internet into a machine behind a firewall, you need the machine in question to open an SSH connection to the outside world and include a <code class="docutils literal notranslate"><span class="pre">-R</span></code> tunnel whose “entry” point is the “remote” side of his connection.</p>
<p><img alt="Reverse tunnelling" src="../../_images/ssh-l-r.png" /></p>
<p>What if we wish to connect to an internal university website from home with a set-up like above in tunnelling with local port forwarding? The university firewall is blocking all incoming traffic. We can connect from home to the university internal network so that we can browse the internal site. We can initiate the tunnel from the socially-correct computer behind the firewall. This is possible since only incoming traffic is blocked and outgoing traffic is allowed. The client will now be at the home computer and instead of using the <code class="docutils literal notranslate"><span class="pre">-L</span></code> option, the <code class="docutils literal notranslate"><span class="pre">-R</span></code> option, which specifies a reverse tunnel is to be created, is used.</p>
<p>From socially-correct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh -R 9001:internalsite.org:80 user@home 
</pre></div>
</div>
<p>The SSH client at socially-correct will connect to the SSH server running at home creating a SSH channel. The server will bind port 9001 on the home machine to listen for incoming requests that are then routed through the created SSH channel between home and socially-correct. Now it’s possible to browse the internal site by visiting http://localhost:9001 in a web browser on the home machine. The socially-correct machine for work at the university will then create a connection to internalsite.org and relay back the response to home via the created SSH channel.</p>
<p><img alt="Remote port forwarding" src="../../_images/remoteportforwarding.png" /></p>
<p>Even though the traffic is encrypted, the name resolution may not be encrypted =&gt; DNS leakage. Programs like firefox allow you to ensure that there is no such <a class="reference internal" href="DNS-leaks.html"><span class="doc std std-doc">DNS leakage</span></a>. In firefox, browse to  <code class="docutils literal notranslate"><span class="pre">about:config</span></code> and make sure the setting for   <code class="docutils literal notranslate"><span class="pre">network.proxy.socks_remote_dns</span></code> is set to true.</p>
</section>
<section id="dynamic-port-forwarding">
<h2>Dynamic port forwarding<a class="headerlink" href="#dynamic-port-forwarding" title="Permalink to this heading"></a></h2>
<p>Dynamic port forwarding allows for configuring one local port for tunnelling data to all remote destinations. This requires Socket Secure SOCKS. At the client side of the tunnel a Socks proxy would be created and the application uses the Socks protocol to specify where the traffic should be sent when it leaves the other end of the ssh tunnel. In a set-up like used in local port forwarding and reverse port forwarding, from the socially-correct machine at university:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh -D 9001 user@home 
</pre></div>
</div>
<p>SSH will create a Socks proxy listening in for connections at local port 9001 and when receiving a request routes the traffic via the SSH channel created between socially-correct and home. Configure the browser to point to the Socks proxy at port <code class="docutils literal notranslate"><span class="pre">9001</span></code> at <code class="docutils literal notranslate"><span class="pre">localhost</span></code>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Renew-IP-lease.html" class="btn btn-neutral float-left" title="Renew IP lease" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Tor.html" class="btn btn-neutral float-right" title="Using Tor" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
        <a href="https://unseen-uni.netlify.app/">Unseen University</a>, 2022

  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>